<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/style.css" rel="stylesheet" type="text/css">
    <link href="https://www.sigwinch.xyz/scheme/pqueues.html"
          rel="canonical">
    <title>(pqueues): Priority queues</title>
  </head>
  <body>
    <h1>(pqueues): Priority queues</h1>

    <p>This is an implementation of functional priority queues in
    portable Scheme (in an R6RS library wrapper).</p>

    <p>These queues are based on a functional variety of binomial
    trees, first described by David J. King in <cite>Functional Binomial
    Queues</cite> (1994).
    The basic
    queue operations run in logarithmic time.  In practice, these queue
    seem very fast, comparable to imperative implementations.</p>

    <p><strong>This library is in development. The interface could change at
    any time.</strong></p>

    <h2 id="toc">Contents</h2>

    <ol>
      <li><a href="#source">Source</a></li>
      <li><a href="#dependencies">Dependencies</a></li>
      <li><a href="#issues">Issues</a></li>
      <li><a href="#specification">Specification</a>
        <ol>
          <li><a href="#constructors">Constructors</a></li>
          <li><a href="#predicates">Predicates</a></li>
          <li><a href="#accessors">Accessors</a></li>
          <li><a href="#updaters">Updaters</a></li>
          <li><a href="#the-whole-pqueue">The whole pqueue</a></li>
          <li><a href="#iteration">Iteration</a></li>
        </ol>
      <li><a href="#copyright">Copyright</a></li>
      <li><a href="#references">References</a></li>
    </ol>


    <h2 id="source">Source</h2>

    <p><a href="code/pqueues.sls">pqueues.sls</a>
    (<a href="code/pqueues.sls.asc">PGP signature</a>).</p>

    <p>A tarball including the library and a (SRFI 64) test suite can
    be found
    <a href="ftp://ftp.sigwinch.xyz/pub/wcm/code/pqueues.tar.bz2">on
    FTP</a>.</p>


    <h2 id="dependencies">Dependencies</h2>

    <p>SRFIs 1, 9, and 128 are required.</p>


    <h2 id="issues">Issues</h2>

    <p>The delete and decrease-key operations aren’t yet implemented.
    As Brodal &amp; Okasaki note in their paper, these are difficult to
    implement efficiently on functional trees.</p>

    <p>King actually implements decrease-key as a simple insertion (which
    falls back to identity on the queue when the key isn’t found). This
    is probably fine in many cases, but it can obviously blow up
    space-usage if you use a lot of decrease-key operations.</p>


    <h2 id="specification">Specification</h2>

    <p>A <dfn>priority queue</dfn> (“pqueue”) represents a homogeneous
    fully-ordered sequence.</p>

    <p>The type and ordering of a priority queue is defined by an embedded
    SRFI 128 comparator object (with mandatory type-test, equality, and
    ordering predicates).</p>


    <h3 id="constructors">Constructors</h3>

    <p><code>(pqueue <var>comparator</var> <var>element</var> …) →
    pqueue</code></p>

    <p>Returns a priority queue with the given elements.  Each
    <var>element</var> must satisfy <var>comparator</var>’s type-test
    predicate.  Runs in O(<var>m</var> log <var>n</var>) time, where
    <var>m</var> is the number of <var>elements</var>.</p>


    <h3 id="predicates">Predicates</h3>

    <p><code>(pqueue? <var>obj</var>) → boolean</code></p>

    <p>Returns <code>#t</code> if <var>obj</var> is a priority queue and
    <code>#f</code> otherwise.</p>

    <p><code>(pqueue-empty? <var>pqueue</var>) → boolean</code></p>

    <p>Returns <code>#t</code> if <var>pqueue</var> is empty and
    <code>#f</code> otherwise.</p>


    <h3 id="accessors">Accessors</h3>

    <p><code>(pqueue-min <var>pqueue</var>) → *</code></p>

    <p>Returns the least element of <var>pqueue</var>, defined by
    <var>pqueue</var>’s ordering.  If <var>pqueue</var> is empty, an
    assertion violation is signaled. Runs in O(log <var>n</var>) time.</p>

    <p><code>(pqueue-element-comparator <var>pqueue</var>) →
    comparator</code></p>

    <p>Returns <var>pqueue</var>’s embedded element comparator.</p>


    <h3 id="updaters">Updaters</h3>

    <p><code>(pqueue-delete-min <var>pqueue</var>) → pqueue</code></p>

    <p>Returns a priority queue with the same type predicate and ordering
    as <var>pqueue</var>, and with the same elements except for the least.
    An assertion violation is signaled if <var>pqueue</var> is empty.
    Runs in O(log <var>n</var>) time.</p>

    <p><code>(pqueue-pop <var>pqueue</var>) → [* pqueue]</code></p>

    <p>Returns two values: the least element of <var>pqueue</var> and a
    new pqueue containing all of the other elements of <var>pqueue</var>.
    This is equivalent to:</p>

<pre><code>(values (pqueue-min pqueue)
        (pqueue-delete-min pqueue))
</code></pre>

    <p>but will usually be more efficient.  An assertion violation is
    signaled if <var>pqueue</var> is empty.  Runs in O(log <var>n</var>)
    time.</p>

    <p><code>(pqueue-meld <var>pqueue</var> …) → pqueue</code></p>

    <p>Returns a priority queue containing all of the elements of the
    <var>pqueue</var>s.  The comparator of the resulting pqueue is taken
    from one of the arguments (which is unspecified).
    While the <var>pqueues</var> may have different
    comparators (in the sense of <code>eqv?</code>), they must define the
    same element type and equality and ordering relations.  (This is
    not checked.)</p>


    <h3 id="the-whole-pqueue">The whole pqueue</h3>

    <p><code>(pqueue-size <var>pqueue</var>) → exact-integer</code></p>

    <p>Returns the number of elements in <var>pqueue</var>. Runs in
    O(log <var>n</var>) time.</p>


    <h3 id="iteration">Iteration</h3>

    <p>Priority-queue folds iterate by successively popping elements
    from the pqueue(s) until they are all empty.  When more than one
    pqueue is folded, all pqueues must be of the same length.  If they
    are not, an assertion violation is signaled.</p>

    <p><code>(pqueue-fold-right <var>proc</var> <var>base</var>
    <var>pqueue<sub>1</sub></var> <var>pqueue<sub>2</sub></var>) → *</p>

    <p>Right folds <var>proc<var> over the elements of the
    <var>pqueue</var>s in order.  <var>proc</var> is invoked as
    <code>(<var>proc</var> <var>e<sub>1</sub></var>
    <var>e<sub>2</sub></var> … <var>seed</var>)</code>, where
    <var>e<sub>i</sub></var> is an element drawn from the <var>i</var>th
    <var>pqueue</var>.</p>

    <h4>Example</h4>

<pre><code>(pqueue-fold-right cons '() (pqueue integer-comparator 3 2 1))
  ⇒ (1 2 3)
</code></pre>

    <p><code>(pqueue-fold-left <var>proc</var> <var>base</var>
    <var>pqueue<sub>1</sub></var> <var>pqueue<sub>2</sub></var>) → *</p>

    <p>Left folds <var>proc<var> over the elements of the
    <var>pqueue</var>s in order.  <var>proc</var> is invoked as
    <code>(<var>proc</var> <var>seed</var> <var>e<sub>1</sub></var>
    <var>e<sub>2</sub></var> …)</code>, where
    <var>e<sub>i</sub></var> is an element drawn from the <var>i</var>th
    <var>pqueue</var>.</p>


    <h2 id="copyright">Copyright</h2>

    <p>© 2024--2026 by Wolfgang Corcoran-Mathe</p>

    <p>Licensed under the
    <a href="https://opensource.org/license/MIT">MIT (Expat)</a>
    license.</p>


    <h2 id="references">References</h2>

    <p>D. J. King (1994) <cite>Functional binomial queues</cite>.
    <cite>Glasgow Workshop on Functional Programming</cite>, p.
    141–150.
    (<a
    href="https://www.cs.cornell.edu/courses/cs312/2005fa/hw/binomial-queues.pdf">PDF</a>)</p>

    <p>Gerth Stølting Brodal &amp; Chris Okasaki (1996) <cite>Optimal
    purely functional priority queues</cite>.
    <cite>Journal of Functional Programming 6</cite>, p. 836–857.
    (<a
    href="https://www.cs.tufts.edu/comp/150FP/archive/chris-okasaki/optimal-pq-jfp.pdf">PDF</a>)</p>

    <p><a href="/index.html">Home</a></p>
  </body>
</html>
